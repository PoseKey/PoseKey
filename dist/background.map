{"version":3,"sources":["background.js"],"names":["console","log","is","lastTab","lastWindow","chrome","tabs","onUpdated","addListener","onLoad","onCreated","onActivated","active","windows","onFocusChanged","window","runtime","onMessage","gotMessage","message","sender","sendResponse","data","msg","browserAction","setIcon","path","query","i","length","sendMessage","id","currentWindow","current","buttonClicked","tab","msg2","tabId","windowId","highlight"],"mappings":"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","file":"background.map","sourceRoot":"..","sourcesContent":["console.log('background running');\r\n\r\nlet is = true;\r\nlet lastTab;\r\nlet lastWindow;\r\n// chrome.browserAction.onClicked.addListener(buttonClicked);\r\nchrome.tabs.onUpdated.addListener(onLoad);\r\nchrome.tabs.onCreated.addListener(onLoad);\r\nchrome.tabs.onActivated.addListener(active);    //active는 하나밖에 없음\r\nchrome.windows.onFocusChanged.addListener(window);\r\nchrome.runtime.onMessage.addListener(gotMessage);\r\n// chrome.tabs.onHighlighted.addListener(highlight);\r\n\r\nfunction gotMessage(message, sender, sendResponse){\r\n    console.log(message);\r\n    if(message.data==\"trigger\"){\r\n        let msg = {\r\n            data: \"ON\"\r\n        };\r\n        if(is===true){\r\n            msg.data = \"OFF\";\r\n            is = false;\r\n            chrome.browserAction.setIcon({path: \"likeR.png\"});\r\n            /* 모든 탭에 OFF하라고 보냄*/\r\n            chrome.tabs.query({}, function(tabs) {\r\n                for (let i=0; i<tabs.length; i++) {\r\n                    chrome.tabs.sendMessage(tabs[i].id, msg);\r\n                }\r\n            });\r\n        }\r\n        else {\r\n            is = true;\r\n            chrome.browserAction.setIcon({path: \"likeG.png\"});\r\n            chrome.tabs.query({active:true,currentWindow: true},function(tabs){\r\n                var current = tabs[0].id;\r\n                chrome.tabs.sendMessage(current, msg);\r\n            });   // 현재 탭에만 ON하라고 보냄\r\n        }\r\n    }\r\n    sendResponse({data:is});\r\n}\r\nfunction buttonClicked(tab) {\r\n    console.log(\"button clicked!\");\r\n    console.log(tab);\r\n    let msg = {\r\n        data: \"ON\"\r\n    };\r\n    if(is===true){\r\n        msg.data = \"OFF\";\r\n        is = false;\r\n        chrome.browserAction.setIcon({path: \"likeR.png\"});\r\n        /* 모든 탭에 OFF하라고 보냄*/\r\n        chrome.tabs.query({}, function(tabs) {\r\n            for (let i=0; i<tabs.length; i++) {\r\n                chrome.tabs.sendMessage(tabs[i].id, msg);\r\n            }\r\n        });\r\n    }\r\n    else {\r\n        is = true;\r\n        chrome.browserAction.setIcon({path: \"likeG.png\"});\r\n        chrome.tabs.sendMessage(tab.id, msg);   // 현재 탭에만 ON하라고 보냄\r\n    }\r\n}\r\n\r\nfunction onLoad(id){\r\n    console.log(\"onLoad!\");\r\n    // console.log(id);\r\n    let msg \r\n    if (is === true){\r\n        msg = {\r\n            data: \"ON\"\r\n        };\r\n    }\r\n    else {\r\n        msg = {\r\n            data: \"OFF\"\r\n        };\r\n    }\r\n    chrome.tabs.sendMessage(id, msg);\r\n}\r\n\r\nfunction active(tab){\r\n    // console.log(\"tab changed!\");\r\n    // console.log(tab.tabId);\r\n    let msg={\r\n        data: \"ON\"\r\n    }\r\n    let msg2={\r\n        data: \"OFF\"\r\n    }\r\n    if (is === false){\r\n        msg.data = \"OFF\";\r\n    }\r\n    chrome.tabs.query({active:false}, function(tabs) {\r\n        for (let i=0; i<tabs.length; i++) {\r\n            chrome.tabs.sendMessage(tabs[i].id, msg2);\r\n        }\r\n    });\r\n    chrome.tabs.sendMessage(tab.tabId, msg);\r\n    // if(lastTab){\r\n    //     chrome.tabs.sendMessage(lastTab, msg2);\r\n    // }\r\n    // lastTab = tab.tabId;\r\n}\r\n\r\nfunction window(windowId){\r\n    let msg={\r\n        data: \"ON\"\r\n    }\r\n    let msg2={\r\n        data: \"OFF\"\r\n    }\r\n    if (is === false){\r\n        msg.data = \"OFF\";\r\n    }\r\n    chrome.tabs.query({active:false}, function(tabs) {\r\n        for (let i=0; i<tabs.length; i++) {\r\n            chrome.tabs.sendMessage(tabs[i].id, msg2);\r\n        }\r\n    });\r\n\r\n    // console.log(\"window changed!\");\r\n    chrome.tabs.query({active:true,currentWindow: true},function(tabs){\r\n        var current = tabs[0].id;\r\n        // console.log(windowId + \", \" + current);\r\n        chrome.tabs.sendMessage(current, msg);\r\n        // chrome.tabs.sendMessage(lastTab, msg2);\r\n        lastTab = current;\r\n        // lastWindow=windowId;\r\n    });\r\n    // if(lastWindow!=windowId){\r\n    //     chrome.tabs.sendMessage(lastTab, msg2);\r\n    // }\r\n}\r\n\r\nfunction highlight(tab){\r\n    console.log(\"highlight!\");\r\n}\r\n"]}
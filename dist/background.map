{"version":3,"sources":["background.js"],"names":["console","log","is","lastTab","lastWindow","first","secondImage","firstImage","pm","sc","fq","ac","defaults","customs","custom","login","uid","local","storedModel","isDialog","ri","gi","bi","ti","hi","vi","msg","msg2","load","loadS","save","chrome","storage","sync","set","power","sets","pmm","scm","fqm","acm","get","data","browserAction","setIcon","path","tabs","create","url","updateMsg","customm","defaultsm","customsm","uidm","isDialogm","rim","gim","bim","tim","him","vim","onUpdated","addListener","onLoad","onCreated","onActivated","active","windows","onFocusChanged","window","runtime","onMessage","gotMessage","message","sender","sendResponse","query","i","length","sendMessage","id","currentWindow","current","includes","undefined","exist","push","tab","remove","index","move","windowId","localm","tabId"],"mappings":"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","file":"background.map","sourceRoot":"..","sourcesContent":["console.log('background running');\r\n\r\nlet is = null;\r\nlet lastTab;\r\nlet lastWindow;\r\nlet first = false;\r\nlet secondImage =\"standing-up-man-.png\";\r\nlet firstImage =\"man-celebrating1.png\";\r\n\r\n//setting values initialized by message from background\r\n//pm = posenet model\r\n//sc = image scale\r\n//fq = frequency\r\n//ac = accuracy\r\nlet pm, sc, fq, ac;\r\n/*\r\n * defaults = 사용자의 기본 모델 기능 맵핑 리스트 \r\n * customs = 사용자의 커스텀 모델 기능 매핑 리스트\r\n * custom = 커스텀 모델로 설정 여부\r\n */\r\nlet defaults, customs, custom;\r\n\r\n/*\r\n * login = 로그인 여부, true or false\r\n * uid = 로그인한 사용자의 uid\r\n * local = custom 모델 생성 여부\r\n * storedModel = custom 모델 생성자들의 uid 리스트\r\n */\r\n\r\nlet login, uid, local = false, storedModel;\r\n\r\n/*\r\n *\r\n *\r\n */\r\nlet isDialog = true, ri, gi, bi, ti, hi, vi;\r\n\r\nlet msg, msg2;\r\n\r\nload();\r\nloadS();\r\n//power\r\nfunction save(){\r\n    if(is==true)\r\n        chrome.storage.sync.set({\r\n            power: true,\r\n            first: false,\r\n            sets:{\r\n                pm: pm,\r\n                sc: sc,\r\n                fq: fq,\r\n                ac: ac,\r\n                custom:custom, defaults:defaults, customs:customs,\r\n                local: local,\r\n                storedModel: storedModel,\r\n            }\r\n        });\r\n    else\r\n        chrome.storage.sync.set({\r\n            power: false,\r\n            first: false,\r\n            sets:{\r\n                pmm: pm,\r\n                scm: sc,\r\n                fqm: fq,\r\n                acm: ac,\r\n                custom:custom, defaults:defaults, customs:customs,\r\n                local: local,\r\n            }});\r\n}\r\nfunction load(){\r\n    chrome.storage.sync.get('power',function(data){\r\n        is = data.power;\r\n        console.log(data.power);\r\n        if(is)chrome.browserAction.setIcon({path: firstImage});\r\n        else chrome.browserAction.setIcon({path: secondImage});\r\n    });\r\n    chrome.storage.sync.get('first',(data)=>{\r\n        if(data.first) first = data.first;\r\n        else first = true;\r\n    })\r\n    if(first) chrome.tabs.create({url : \"/option/index.html\"});\r\n}\r\n\r\nfunction loadS(){\r\n    chrome.storage.sync.get('sets',function(data){\r\n        // console.log(data);\r\n        if(data.pm) pm = data.pm; else pm = 1;\r\n        if(data.sc) sc = data.sc; else sc = 0.3;\r\n        if(data.fq) fq = data.fq; else fq = 500;\r\n        if(data.ac) ac = data.ac; else ac = 60;\r\n        if(data.custom) custom = data.custom; else custom = false;\r\n        if(data.defaults) defaults = data.defaults; else defaults = [null,null,null,null,null,null];\r\n        if(data.customs) customs = data.customs; else customs = [null,null,null,null,null,null];\r\n        if(data.local) local = data.local; else local = false;\r\n        if(data.storedModel) storedModel = data.storedModel; else storedModel = [];\r\n        if(data.isDialog == false) isDialog = data.isDialog;else isDialog = true;\r\n        if(data.ri) ri = data.ri; else ri = 56;\r\n        if(data.gi) gi = data.gi; else gi = 104;\r\n        if(data.bi) bi = data.bi; else bi = 188;\r\n        if(data.ti) ti = data.ti; else ti = 0.3;\r\n        if(data.hi == false) hi = data.hi; else hi = true;\r\n        if(data.vi == false) vi = data.vi; else vi = true;\r\n    });\r\n}\r\nfunction updateMsg(){\r\n    msg={\r\n        data: \"ON\", pmm:pm, scm:sc, fqm:fq, acm:ac, customm:custom, defaultsm:defaults, customsm:customs, uidm:uid,\r\n        isDialogm: isDialog,\r\n        rim: ri,\r\n        gim: gi,\r\n        bim: bi,\r\n        tim: ti,\r\n        him: hi,\r\n        vim: vi,\r\n    }\r\n    msg2={\r\n        data: \"OFF\", pmm:pm, scm:sc, fqm:fq, acm:ac, customm:custom, defaultsm:defaults, customsm:customs, uidm:uid, \r\n        isDialogm: isDialog,\r\n        rim: ri,\r\n        gim: gi,\r\n        bim: bi,\r\n        tim: ti,\r\n        him: hi,\r\n        vim: vi,\r\n    }\r\n}\r\n// chrome.browserAction.onClicked.addListener(buttonClicked);\r\nchrome.tabs.onUpdated.addListener(onLoad);\r\nchrome.tabs.onCreated.addListener(onLoad);\r\nchrome.tabs.onActivated.addListener(active);    //active는 하나밖에 없음\r\nchrome.windows.onFocusChanged.addListener(window);\r\nchrome.runtime.onMessage.addListener(gotMessage);\r\n// chrome.tabs.onHighlighted.addListener(highlight);\r\n\r\nfunction gotMessage(message, sender, sendResponse){\r\n    console.log(message);\r\n    if(message.data==\"trigger\"){\r\n        if(is===true){\r\n            is = false;\r\n            updateMsg();\r\n            chrome.browserAction.setIcon({path: secondImage});\r\n            /* 모든 탭에 OFF하라고 보냄*/\r\n            chrome.tabs.query({}, function(tabs) {\r\n                for (let i=0; i<tabs.length; i++) {\r\n                    chrome.tabs.sendMessage(tabs[i].id, msg2);\r\n                }\r\n            });\r\n        }\r\n        else {\r\n            is = true;\r\n            updateMsg();\r\n            chrome.browserAction.setIcon({path: firstImage});\r\n            chrome.tabs.query({active:true,currentWindow: true},function(tabs){\r\n                var current = tabs[0].id;\r\n                chrome.tabs.sendMessage(current, msg);\r\n            });   // 현재 탭에만 ON하라고 보냄\r\n        }\r\n    }\r\n    else if(message.data == \"?\"){\r\n        console.log(\"?\");\r\n    }\r\n    else if(message.data ==\"ON\"){\r\n        is = true;\r\n        updateMsg();\r\n        chrome.browserAction.setIcon({path: firstImage});\r\n        chrome.tabs.query({active:true,currentWindow: true},function(tabs){\r\n            var current = tabs[0].id;\r\n            chrome.tabs.sendMessage(current, msg);\r\n        });\r\n    }\r\n    else if(message.data ==\"OFF\"){\r\n        is = false;\r\n        updateMsg();\r\n        chrome.browserAction.setIcon({path: secondImage});\r\n        /* 모든 탭에 OFF하라고 보냄*/\r\n        chrome.tabs.query({}, function(tabs) {\r\n            for (let i=0; i<tabs.length; i++) {\r\n                chrome.tabs.sendMessage(tabs[i].id, msg);\r\n            }\r\n        });\r\n    }\r\n    else if(message.data == \"setting\"){\r\n        pm = message.pmm;\r\n        sc = message.scm;\r\n        fq = message.fqm;\r\n        ac = message.acm;\r\n    }\r\n    else if(message.data == \"poses\"){\r\n        custom = message.customm;\r\n        defaults = message.defaultsm;\r\n        customs = message.customsm;\r\n    }\r\n    else if(message.data ==\"interface\"){\r\n        ri = message.rim;\r\n        gi = message.gim;\r\n        bi = message.bim;\r\n        ti = message.tim;\r\n    }\r\n    else if(message.data ==\"interfaceIO\"){\r\n        isDialog = message.isDialogm;\r\n        hi = message.him;\r\n        vi = message.vim;\r\n    }\r\n    else if (message.data ==\"login\"){\r\n        uid = message.uidm;\r\n        local = storedModel.includes(uid);\r\n        // console.log(storedModel, local);\r\n    }\r\n    else if (message.data == \"logout\"){\r\n        login = false;\r\n        uid = undefined;\r\n        local = false;\r\n        custom = false;\r\n    }\r\n    else if (message.data == \"saveModel\"){\r\n        let exist = storedModel.includes(message.uidm);\r\n        let id = message.uidm;\r\n        if(!exist) storedModel.push(id);\r\n        local = true;\r\n    }\r\n\r\n    //function mapped to poses\r\n    else if(message.data == \"close tab\"){\r\n        chrome.tabs.query({currentWindow: true, active: true}, (tab) => {\r\n            chrome.tabs.remove(tab[0].id)\r\n        })\r\n    }\r\n    else if(message.data == \"move tab left\"){\r\n        chrome.tabs.query({currentWindow: true, active: true}, (tab) => {\r\n            if (tab[0].index > 0) {\r\n                chrome.tabs.move(tab[0].id, {'index': tab[0].index - 1})\r\n            }\r\n        })\r\n    }\r\n    else if(message.data == \"move tab right\"){\r\n        chrome.tabs.query({currentWindow: true, active: true}, (tab) => {\r\n            chrome.tabs.move(tab[0].id, {'index': tab[0].index + 1})\r\n        })\r\n    }\r\n    else if(message.data == \"close window\"){\r\n        chrome.tabs.query({currentWindow: true, active: true}, (tab) => {\r\n            chrome.windows.remove(tab[0].windowId)\r\n        })\r\n    }\r\n    // else if(message.data == \"zoom-in\"){\r\n    //     chrome.tabs.query({currentWindow: true, active: true}, (tab) => {\r\n    //         chrome.tabs.getZoom(tab[0].id, (zoomFactor) => {\r\n    //             // console.log(zoomFactor)\r\n    //             chrome.tabs.setZoom(tab[0].id, zoomFactor + 0.1)\r\n    //         })\r\n    //     })\r\n    // }\r\n    // else if(message.data == \"zoom-out\"){\r\n    //     chrome.tabs.query({currentWindow: true, active: true}, (tab) => {\r\n    //         chrome.tabs.getZoom(tab[0].id, (zoomFactor) => {\r\n    //             chrome.tabs.setZoom(tab[0].id, zoomFactor - 0.1)\r\n    //         })\r\n    //     })\r\n    // }\r\n    // else if(message.data == \"zoom-reset\"){\r\n    //     chrome.tabs.query({currentWindow: true, active: true}, (tab) => {\r\n    //         chrome.tabs.setZoom(tab[0].id, 0)\r\n    //     })     \r\n    // }\r\n    // else if(message.data == \"back\"){\r\n    //     chrome.tabs.executeScript(null, {'code': 'window.history.back()'})\r\n    // }\r\n    // else if(message.data == \"forward\"){\r\n    //     chrome.tabs.executeScript(null, {'code': 'window.history.forward()'})    \r\n    // }\r\n    // else if(message.data == \"reload\"){\r\n    //     chrome.tabs.executeScript(null, {'code': 'window.location.reload()'})   \r\n    // }\r\n\r\n    save();\r\n    sendResponse({\r\n        data:is,\r\n        pmm:pm,\r\n        scm:sc,\r\n        fqm:fq,\r\n        acm:ac,\r\n        customm:custom,\r\n        defaultsm:defaults,\r\n        customsm:customs,\r\n        localm: local,\r\n        isDialogm: isDialog,\r\n        rim: ri,\r\n        gim: gi,\r\n        bim: bi,\r\n        tim: ti,\r\n        him: hi,\r\n        vim: vi,\r\n    });\r\n}\r\n\r\nfunction onLoad(id){\r\n    console.log(\"onLoad!\");\r\n    // console.log(id);\r\n    updateMsg();\r\n    if (is == false) {\r\n        msg.data = \"OFF\";\r\n    }\r\n    save();\r\n    chrome.tabs.sendMessage(id, msg);\r\n}\r\n\r\nfunction active(tab){\r\n    // console.log(\"tab changed!\");\r\n    // console.log(tab.tabId);\r\n    updateMsg();\r\n    if (is === false){\r\n        msg.data = \"OFF\";\r\n    }\r\n    chrome.tabs.query({active:false}, function(tabs) {\r\n        for (let i=0; i<tabs.length; i++) {\r\n            chrome.tabs.sendMessage(tabs[i].id, msg2);\r\n        }\r\n    });\r\n    chrome.tabs.sendMessage(tab.tabId, msg);\r\n    save();\r\n}\r\n\r\nfunction window(windowId){\r\n    updateMsg();\r\n    if (is === false){\r\n        msg.data = \"OFF\";\r\n    }\r\n    chrome.tabs.query({active:false}, function(tabs) {\r\n        for (let i=0; i<tabs.length; i++) {\r\n            chrome.tabs.sendMessage(tabs[i].id, msg2);\r\n        }\r\n    });\r\n\r\n    // console.log(\"window changed!\");\r\n    chrome.tabs.query({active:true,currentWindow: true},function(tabs){\r\n        var current = tabs[0].id;\r\n        // console.log(windowId + \", \" + current);\r\n        chrome.tabs.sendMessage(current, msg);\r\n        // chrome.tabs.sendMessage(lastTab, msg2);\r\n        lastTab = current;\r\n        // lastWindow=windowId;\r\n    });\r\n    save();\r\n}\r\n"]}
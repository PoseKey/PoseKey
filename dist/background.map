{"version":3,"sources":["background.js"],"names":["console","log","is","lastTab","lastWindow","secondImage","firstImage","pm","sc","fq","ac","defaults","customs","custom","login","uid","local","storedModel","load","loadS","save","chrome","storage","sync","set","power","sets","pmm","scm","fqm","acm","customm","defaultsm","customsm","get","data","browserAction","setIcon","path","tabs","create","url","onUpdated","addListener","onLoad","onCreated","onActivated","active","windows","onFocusChanged","window","runtime","onMessage","gotMessage","message","sender","sendResponse","msg","query","i","length","sendMessage","id","currentWindow","current","uidm","includes","undefined","exist","push","tab","remove","index","move","windowId","localm","msg2","tabId"],"mappings":"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","file":"background.map","sourceRoot":"..","sourcesContent":["console.log('background running');\r\n\r\nlet is = null;\r\nlet lastTab;\r\nlet lastWindow;\r\n\r\nlet secondImage =\"standing-up-man-.png\";\r\nlet firstImage =\"man-celebrating1.png\";\r\n\r\n//setting values initialized by message from background\r\n//pm = posenet model\r\n//sc = image scale\r\n//fq = frequency\r\n//ac = accuracy\r\nlet pm, sc, fq, ac;\r\n/*\r\n * defaults = 사용자의 기본 모델 기능 맵핑 리스트 \r\n * customs = 사용자의 커스텀 모델 기능 매핑 리스트\r\n * custom = 커스텀 모델로 설정 여부\r\n */\r\nlet defaults, customs, custom;\r\n\r\n/*\r\n * login = 로그인 여부, true or false\r\n * uid = 로그인한 사용자의 uid\r\n * local = custom 모델 생성 여부\r\n * storedModel = custom 모델 생성자들의 uid 리스트\r\n */\r\n\r\nlet login, uid, local = false, storedModel;\r\n\r\nload();\r\nloadS();\r\n//power\r\nfunction save(){\r\n    if(is==true)\r\n        chrome.storage.sync.set({\r\n            power: true,\r\n            sets:{\r\n                pmm: pm,\r\n                scm: sc,\r\n                fqm: fq,\r\n                acm: ac,\r\n                customm:custom, defaultsm:defaults, customsm:customs,\r\n            }\r\n        });\r\n    else\r\n        chrome.storage.sync.set({\r\n            power: false,\r\n            sets:{\r\n                pmm: pm,\r\n                scm: sc,\r\n                fqm: fq,\r\n                acm: ac,\r\n                customm:custom, defaultsm:defaults, customsm:customs,\r\n            }});\r\n}\r\nfunction load(){\r\n    chrome.storage.sync.get('power',function(data){\r\n        is = data.power;\r\n        console.log(data.power);\r\n        if(is)chrome.browserAction.setIcon({path: firstImage});\r\n        else chrome.browserAction.setIcon({path: secondImage});\r\n    });\r\n    chrome.tabs.create({url : \"/option/index.html\"});\r\n}\r\n\r\nfunction loadS(){\r\n    chrome.storage.sync.get('sets',function(data){\r\n        // console.log(data);\r\n        if(data.pm) pm = data.pm; else pm = 1;\r\n        if(data.sc) sc = data.sc; else sc = 0.3;\r\n        if(data.fq) fq = data.fq; else fq = 500;\r\n        if(data.ac) ac = data.ac; else ac = 60;\r\n        if(data.custom) custom = data.custom; else custom = false;\r\n        if(data.defaults) defaults = data.defaults; else defaults = [null,null,null,null,null,null];\r\n        if(data.customs) customs = data.customs; else customs = [null,null,null,null,null,null];\r\n        if(data.storedModel) storedModel = data.storedModel; else storedModel = [];\r\n    });\r\n}\r\n\r\n// chrome.browserAction.onClicked.addListener(buttonClicked);\r\nchrome.tabs.onUpdated.addListener(onLoad);\r\nchrome.tabs.onCreated.addListener(onLoad);\r\nchrome.tabs.onActivated.addListener(active);    //active는 하나밖에 없음\r\nchrome.windows.onFocusChanged.addListener(window);\r\nchrome.runtime.onMessage.addListener(gotMessage);\r\n// chrome.tabs.onHighlighted.addListener(highlight);\r\n\r\nfunction gotMessage(message, sender, sendResponse){\r\n    console.log(message);\r\n    if(message.data==\"trigger\"){\r\n        let msg = {\r\n            data: \"ON\", pmm:pm, scm:sc, fqm:fq, acm:ac, customm:custom, defaultsm:defaults, customsm:customs,\r\n        };\r\n        if(is===true){\r\n            msg.data = \"OFF\";\r\n            is = false;\r\n            chrome.browserAction.setIcon({path: secondImage});\r\n            /* 모든 탭에 OFF하라고 보냄*/\r\n            chrome.tabs.query({}, function(tabs) {\r\n                for (let i=0; i<tabs.length; i++) {\r\n                    chrome.tabs.sendMessage(tabs[i].id, msg);\r\n                }\r\n            });\r\n        }\r\n        else {\r\n            is = true;\r\n            chrome.browserAction.setIcon({path: firstImage});\r\n            chrome.tabs.query({active:true,currentWindow: true},function(tabs){\r\n                var current = tabs[0].id;\r\n                chrome.tabs.sendMessage(current, msg);\r\n            });   // 현재 탭에만 ON하라고 보냄\r\n        }\r\n    }\r\n    else if(message.data == \"?\"){\r\n        console.log(\"?\");\r\n    }\r\n    else if(message.data ==\"ON\"){\r\n        is = true;\r\n        chrome.browserAction.setIcon({path: firstImage});\r\n        chrome.tabs.query({active:true,currentWindow: true},function(tabs){\r\n            var current = tabs[0].id;\r\n            chrome.tabs.sendMessage(current, msg);\r\n        });\r\n    }\r\n    else if(message.data ==\"OFF\"){\r\n        is = false;\r\n        chrome.browserAction.setIcon({path: secondImage});\r\n        /* 모든 탭에 OFF하라고 보냄*/\r\n        chrome.tabs.query({}, function(tabs) {\r\n            for (let i=0; i<tabs.length; i++) {\r\n                chrome.tabs.sendMessage(tabs[i].id, msg);\r\n            }\r\n        });\r\n    }\r\n    else if(message.data == \"setting\"){\r\n        pm = message.pmm;\r\n        sc = message.scm;\r\n        fq = message.fqm;\r\n        ac = message.acm;\r\n    }\r\n    else if(message.data == \"poses\"){\r\n        custom = message.customm;\r\n        defaults = message.defaultsm;\r\n        customs = message.customsm;\r\n    }\r\n    else if (message.data ==\"login\"){\r\n        login = true;\r\n        uid = message.uidm;\r\n        local = storedModel.includes(uid);\r\n        console.log(storedModel, local);\r\n    }\r\n    else if (message.data == \"logout\"){\r\n        login = false;\r\n        uid = undefined;\r\n        local = false;\r\n        custom = false;\r\n    }\r\n    else if (message.data == \"saveModel\"){\r\n        let exist = storedModel.includes(message.uidm);\r\n        let id = message.uidm;\r\n        if(!exist) storedModel.push(id);\r\n        local = true;\r\n    }\r\n\r\n    //function mapped to poses\r\n    else if(message.data == \"close tab\"){\r\n        chrome.tabs.query({currentWindow: true, active: true}, (tab) => {\r\n            chrome.tabs.remove(tab[0].id)\r\n        })\r\n    }\r\n    else if(message.data == \"move tab left\"){\r\n        chrome.tabs.query({currentWindow: true, active: true}, (tab) => {\r\n            if (tab[0].index > 0) {\r\n                chrome.tabs.move(tab[0].id, {'index': tab[0].index - 1})\r\n            }\r\n        })\r\n    }\r\n    else if(message.data == \"move tab right\"){\r\n        chrome.tabs.query({currentWindow: true, active: true}, (tab) => {\r\n            chrome.tabs.move(tab[0].id, {'index': tab[0].index + 1})\r\n        })\r\n    }\r\n    else if(message.data == \"close window\"){\r\n        chrome.tabs.query({currentWindow: true, active: true}, (tab) => {\r\n            chrome.windows.remove(tab[0].windowId)\r\n        })\r\n    }\r\n    // else if(message.data == \"zoom-in\"){\r\n    //     chrome.tabs.query({currentWindow: true, active: true}, (tab) => {\r\n    //         chrome.tabs.getZoom(tab[0].id, (zoomFactor) => {\r\n    //             // console.log(zoomFactor)\r\n    //             chrome.tabs.setZoom(tab[0].id, zoomFactor + 0.1)\r\n    //         })\r\n    //     })\r\n    // }\r\n    // else if(message.data == \"zoom-out\"){\r\n    //     chrome.tabs.query({currentWindow: true, active: true}, (tab) => {\r\n    //         chrome.tabs.getZoom(tab[0].id, (zoomFactor) => {\r\n    //             chrome.tabs.setZoom(tab[0].id, zoomFactor - 0.1)\r\n    //         })\r\n    //     })\r\n    // }\r\n    // else if(message.data == \"zoom-reset\"){\r\n    //     chrome.tabs.query({currentWindow: true, active: true}, (tab) => {\r\n    //         chrome.tabs.setZoom(tab[0].id, 0)\r\n    //     })     \r\n    // }\r\n    // else if(message.data == \"back\"){\r\n    //     chrome.tabs.executeScript(null, {'code': 'window.history.back()'})\r\n    // }\r\n    // else if(message.data == \"forward\"){\r\n    //     chrome.tabs.executeScript(null, {'code': 'window.history.forward()'})    \r\n    // }\r\n    // else if(message.data == \"reload\"){\r\n    //     chrome.tabs.executeScript(null, {'code': 'window.location.reload()'})   \r\n    // }\r\n\r\n    save();\r\n    sendResponse({data:is, pmm:pm, scm:sc, fqm:fq, acm:ac, customm:custom, defaultsm:defaults, customsm:customs, localm: local });\r\n}\r\n\r\n// function buttonClicked(tab) {\r\n//     console.log(\"button clicked!\");\r\n//     console.log(tab);\r\n//     let msg = {\r\n//         data: \"ON\", pmm:pm, scm:sc, fqm:fq, acm:ac, customm:custom, defaultsm:defaults, customsm:customs, uidm:uid\r\n//     };\r\n//     if(is===true){\r\n//         msg.data = \"OFF\";\r\n//         is = false;\r\n//         chrome.browserAction.setIcon({path: secondImage});\r\n//         /* 모든 탭에 OFF하라고 보냄*/\r\n//         chrome.tabs.query({}, function(tabs) {\r\n//             for (let i=0; i<tabs.length; i++) {\r\n//                 chrome.tabs.sendMessage(tabs[i].id, msg);\r\n//             }\r\n//         });\r\n//     }\r\n//     else {\r\n//         is = true;\r\n//         chrome.browserAction.setIcon({path: firstImage});\r\n//         chrome.tabs.sendMessage(tab.id, msg);   // 현재 탭에만 ON하라고 보냄\r\n//     }\r\n//     save();\r\n// }\r\n\r\nfunction onLoad(id){\r\n    console.log(\"onLoad!\");\r\n    // console.log(id);\r\n    let msg = {\r\n        data: \"ON\", pmm:pm, scm:sc, fqm:fq, acm:ac, customm:custom, defaultsm:defaults, customsm:customs, uidm:uid\r\n    };\r\n    if (is == false) {\r\n        msg.data = \"OFF\";\r\n    }\r\n    save();\r\n    chrome.tabs.sendMessage(id, msg);\r\n}\r\n\r\nfunction active(tab){\r\n    // console.log(\"tab changed!\");\r\n    // console.log(tab.tabId);\r\n    let msg={\r\n        data: \"ON\", pmm:pm, scm:sc, fqm:fq, acm:ac, customm:custom, defaultsm:defaults, customsm:customs, uidm:uid\r\n    }\r\n    let msg2={\r\n        data: \"OFF\", pmm:pm, scm:sc, fqm:fq, acm:ac, customm:custom, defaultsm:defaults, customsm:customs, uidm:uid\r\n    }\r\n    if (is === false){\r\n        msg.data = \"OFF\";\r\n    }\r\n    chrome.tabs.query({active:false}, function(tabs) {\r\n        for (let i=0; i<tabs.length; i++) {\r\n            chrome.tabs.sendMessage(tabs[i].id, msg2);\r\n        }\r\n    });\r\n    chrome.tabs.sendMessage(tab.tabId, msg);\r\n    save();\r\n    // if(lastTab){\r\n    //     chrome.tabs.sendMessage(lastTab, msg2);\r\n    // }\r\n    // lastTab = tab.tabId;\r\n}\r\n\r\nfunction window(windowId){\r\n    let msg={\r\n        data: \"ON\", pmm:pm, scm:sc, fqm:fq, acm:ac, customm:custom, defaultsm:defaults, customsm:customs, uidm:uid\r\n    }\r\n    let msg2={\r\n        data: \"OFF\", pmm:pm, scm:sc, fqm:fq, acm:ac, customm:custom, defaultsm:defaults, customsm:customs, uidm:uid\r\n    }\r\n    if (is === false){\r\n        msg.data = \"OFF\";\r\n    }\r\n    chrome.tabs.query({active:false}, function(tabs) {\r\n        for (let i=0; i<tabs.length; i++) {\r\n            chrome.tabs.sendMessage(tabs[i].id, msg2);\r\n        }\r\n    });\r\n\r\n    // console.log(\"window changed!\");\r\n    chrome.tabs.query({active:true,currentWindow: true},function(tabs){\r\n        var current = tabs[0].id;\r\n        // console.log(windowId + \", \" + current);\r\n        chrome.tabs.sendMessage(current, msg);\r\n        // chrome.tabs.sendMessage(lastTab, msg2);\r\n        lastTab = current;\r\n        // lastWindow=windowId;\r\n    });\r\n    // if(lastWindow!=windowId){\r\n    //     chrome.tabs.sendMessage(lastTab, msg2);\r\n    // }\r\n    save();\r\n}\r\n\r\n// function highlight(tab){\r\n//     // console.log(\"highlight!\");\r\n// }\r\n\r\n// function handleMessage(request, sender, sendResponse) {\r\n    \r\n//     if(request.msg == \"close tab\"){\r\n//         chrome.tabs.query({currentWindow: true, active: true}, (tab) => {\r\n//             chrome.tabs.remove(tab[0].id)\r\n//         })\r\n//     }\r\n\r\n//     else if(request.msg == \"move tab left\"){\r\n//         chrome.tabs.query({currentWindow: true, active: true}, (tab) => {\r\n//             if (tab[0].index > 0) {\r\n//             chrome.tabs.move(tab[0].id, {'index': tab[0].index - 1})\r\n//             }\r\n//         })\r\n          \r\n//     }\r\n\r\n//     else if(request.msg == \"move tab right\"){\r\n//         chrome.tabs.query({currentWindow: true, active: true}, (tab) => {\r\n//             chrome.tabs.move(tab[0].id, {'index': tab[0].index + 1})\r\n//         })\r\n          \r\n//     }\r\n\r\n//     else if(request.msg == \"close window\"){\r\n//         chrome.tabs.query({currentWindow: true, active: true}, (tab) => {\r\n//             chrome.windows.remove(tab[0].windowId)\r\n//         })\r\n          \r\n//     }\r\n\r\n//     else if(request.msg == \"zoom-in\"){\r\n//         chrome.tabs.query({currentWindow: true, active: true}, (tab) => {\r\n//             chrome.tabs.getZoom(tab[0].id, (zoomFactor) => {\r\n//               console.log(zoomFactor)\r\n//               chrome.tabs.setZoom(tab[0].id, zoomFactor + 0.1)\r\n//             })\r\n//           })\r\n          \r\n//     }\r\n\r\n//     else if(request.msg == \"zoom-out\"){\r\n//         chrome.tabs.query({currentWindow: true, active: true}, (tab) => {\r\n//             chrome.tabs.getZoom(tab[0].id, (zoomFactor) => {\r\n//               chrome.tabs.setZoom(tab[0].id, zoomFactor - 0.1)\r\n//             })\r\n//           })\r\n          \r\n//     }\r\n\r\n//     else if(request.msg == \"zoom-reset\"){\r\n//         chrome.tabs.query({currentWindow: true, active: true}, (tab) => {\r\n//             chrome.tabs.setZoom(tab[0].id, 0)\r\n//         })\r\n          \r\n//     }\r\n\r\n//     else if(request.msg == \"back\"){\r\n//         chrome.tabs.executeScript(null, {'code': 'window.history.back()'})\r\n//     }\r\n\r\n//     else if(request.msg == \"forward\"){\r\n//         chrome.tabs.executeScript(null, {'code': 'window.history.forward()'})    \r\n//     }\r\n\r\n//     else if(request.msg == \"reload\"){\r\n//         chrome.tabs.executeScript(null, {'code': 'window.location.reload()'})   \r\n//     }\r\n\r\n    \r\n//     //sendResponse({response: \"Response from background script\"});\r\n//   }\r\n  \r\n//   chrome.runtime.onMessage.addListener(handleMessage);\r\n"]}